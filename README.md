# instruction-switch
Generate code for handling complex switches based on bit patterns. The name was given because I hope to use it for decoding machine code instructions. The program generates the body of a C function which you can `#include` in another file.

## Installation
To make the executable usable, do the following on the command line:
```
make
mv instrswitch <a location in your $PATH>
```

## Usage
### Generation
Call the executable with the form
```
instrswitch <instruction table> > <destination>
```
where the instruction table is a TSV file in the following format:
```
name<TAB>format
<instruction name><TAB><instruction format>
```

Each instruction format is a sequence of up to 64 characters. 0s and 1s indicate a bit which is invariant for that instruction. Other characters indicate a bit which can vary. All other characters except '_' or ' ' also correspond to an argument of the instruction, and will be recorded.

The generated code is minified, so run it through `indent` before viewing it.

### Including in C Code
Two macros must be defined above where the autogenerated file is included:
 * `DO_INSTR_(name, args)`: This takes the name of the matching instruction as a symbol and the comma-separated argument list within parentheses.
 * `DO_ERROR_`: This token is used in the case that none of the possible instructions match the pattern.

## Format Overlap
The instruction formats given must be completely unambiguous. For example, this is legal:
```
add<TAB>0aaabbb1
sub<TAB>1aaabbb1
```
But it would be illegal to add:
```
neg<TAB>1aaa1111
```
Because their is no way to tell between the `sub` and `neg` instructions.
